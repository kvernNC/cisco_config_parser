# Regex from https://github.com/networktocode/ntc-templates/blob/master/templates/cisco_ios_show_access-list.template
---
- name: PARSER META DATA
  parser_metadata:
    version: 1.0
    command: sh running-config | inc snmp-server community
    network_os: ios

- name: match sections
  pattern_match:
    # regex:
    #    snmp-server community TEST RO
    #    snmp-server community admingene RO SNMP

    regex: "snmp-server community (\\S+) (RO|RW)"
    match_all: yes
  register: section
  export: yes

- name: GENERATE JSON DATA STRUCTURE
  json_template:
    template:
      - key: "{{ item.matches.0 }}"
        object:
          - key: access
            value: "{{ item.matches.1 }}"
  loop: "{{ section }}"
  export: yes
  export_as: dict
  register: parsed_snmp_community
